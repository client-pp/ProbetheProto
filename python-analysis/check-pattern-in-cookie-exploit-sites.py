import os
import codecs

root_path = "/home/zfk/Documents/sanchecker/src/"
log_dir = "check_cookie_pp_pattern1_0to200k_logs"
ppExploitFOUND_str = "ppExploitFOUND"
objTainted_str = "ObjTaintedDueToTaintKey!"
target_str = "LOGGING:"

if __name__ == "__main__":
    read_file = "websites_to_pp_cookie_storage_0to200k.txt"

    vul_website_logs = set()
    with codecs.open(os.path.join(root_path, read_file), 'r', encoding='utf-8', errors='replace') as f0:
        contents = f0.read()
        for idx, line in enumerate(contents.split('\n')[:-1]):
            # if not ppExploitFOUND_str in line:
            #     continue
            site = line.split(',')[1]
            site = site.replace('.', '_', 1) + '_log_file'
            vul_website_logs.add(site)

    # print('Note: should count these 5 sites as well: 247sports.com, calpoly.edu, usd.edu, fgcu.edu, http://s.visitdays.com/demo/mobi/')
    print(len(vul_website_logs), vul_website_logs)
    found_sites = set()
    for log_file in vul_website_logs:
        with codecs.open(os.path.join(root_path, log_dir, log_file), 'r', encoding='utf-8', errors='replace') as f1: 
            contents = f1.read()
            for idx, line in enumerate(contents.split('\n')):
                # if not objTainted_str in line:
                #     continue
                if target_str in line:
                    found_sites.add(log_file)
                    break

    print(len(found_sites), found_sites)